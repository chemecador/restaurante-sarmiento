---
const navLinks = [
  { href: '#inicio',   label: 'Inicio' },
  { href: '#menus',    label: 'Menús' },
  { href: '#contacto', label: 'Contacto' },
];
---

<header class="fixed top-0 left-0 right-0 z-50 bg-sarmiento-dark/90 backdrop-blur-sm">
  <nav class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
    <a href="#inicio" class="font-serif text-2xl text-sarmiento-amber tracking-wide">
      El Sarmiento
    </a>
    <ul class="hidden md:flex gap-8">
      {navLinks.map(({ href, label }) => (
        <li>
          <a
            href={href}
            class="text-sarmiento-cream hover:text-sarmiento-amber transition-colors duration-200 font-sans text-sm tracking-widest uppercase"
          >
            {label}
          </a>
        </li>
      ))}
    </ul>
    <!-- Mobile menu button -->
    <button id="menu-toggle" class="md:hidden text-sarmiento-cream focus:outline-none" aria-label="Abrir Menú" aria-expanded="false">
      <svg id="menu-icon" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
  </nav>

  <!-- Mobile Side Menu Wrapper (Controla la visibilidad general) -->
  <div id="mobile-menu" class="fixed inset-0 z-50 pointer-events-none md:hidden" aria-hidden="true">
    <!-- Overlay (Oscurece el fondo) -->
    <div 
      id="menu-overlay" 
      class="absolute inset-0 bg-sarmiento-dark/60 backdrop-blur-sm opacity-0 transition-opacity duration-300 ease-in-out pointer-events-none"
    ></div>
    
    <!-- Content Panel (Se desliza) -->
    <nav 
      id="menu-panel"
      class="absolute right-0 top-0 h-dvh w-3/4 max-w-sm bg-sarmiento-dark px-8 py-20 flex flex-col gap-8 shadow-2xl translate-x-full transition-transform duration-300 ease-in-out pointer-events-auto"
    >
      <button id="menu-close" class="absolute top-6 right-6 text-sarmiento-cream p-2" aria-label="Cerrar Menú">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      
      <div class="flex flex-col gap-6 mt-4">
        {navLinks.map(({ href, label }) => (
          <a
            href={href}
            class="mobile-nav-link text-2xl font-serif text-sarmiento-cream hover:text-sarmiento-amber transition-colors duration-200"
          >
            {label}
          </a>
        ))}
      </div>

      <div class="mt-auto pb-8 border-t border-sarmiento-muted/30 pt-8">
        <p class="text-sarmiento-muted text-xs uppercase tracking-[0.2em] mb-4">Reservas</p>
        <a href="tel:+34639580211" class="text-sarmiento-amber font-sans text-xl italic hover:text-sarmiento-cream transition-colors duration-200">
          639 580 211
        </a>
      </div>
    </nav>
  </div>
</header>

<script>
  function setupMenu() {
    const menuToggle = document.getElementById('menu-toggle');
    const menuClose = document.getElementById('menu-close');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuPanel = document.getElementById('menu-panel');
    const menuOverlay = document.getElementById('menu-overlay');
    const navLinks = document.querySelectorAll('.mobile-nav-link');

    function openMenu() {
      mobileMenu?.classList.remove('pointer-events-none');
      menuOverlay?.classList.remove('opacity-0', 'pointer-events-none');
      menuOverlay?.classList.add('pointer-events-auto');
      menuPanel?.classList.remove('translate-x-full');
      menuToggle?.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      menuPanel?.classList.add('translate-x-full');
      menuOverlay?.classList.add('opacity-0', 'pointer-events-none');
      menuOverlay?.classList.remove('pointer-events-auto');
      menuToggle?.setAttribute('aria-expanded', 'false');
      
      // Esperar a que termine la animación para quitar el contenedor principal
      setTimeout(() => {
        if (menuPanel?.classList.contains('translate-x-full')) {
          mobileMenu?.classList.add('pointer-events-none');
          document.body.style.overflow = '';
        }
      }, 300);
    }

    menuToggle?.addEventListener('click', openMenu);
    menuClose?.addEventListener('click', closeMenu);
    menuOverlay?.addEventListener('click', closeMenu);

    navLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });
  }

  setupMenu();
  document.addEventListener('astro:after-swap', setupMenu);
</script>
